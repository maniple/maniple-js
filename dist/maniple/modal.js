define(["jquery"],function(a){function b(){var b=a(window);j||(j=g("dialog-overlay"),j.data("overlayOpacity",j.css("opacity"))),k||(k=g("dialog-container"),k.hide()),i||(i=g("dialog"),i.css("opacity",0)),j.css({position:"absolute",top:0,right:0,bottom:0,left:0}),k.css({position:"relative",overflowX:"auto",overflowY:"scroll",height:"100%",paddingTop:0,paddingBottom:0}),i.css({position:"fixed",top:0,right:0,bottom:0,left:0,zIndex:999999999}),i.append(j),i.append(k),i.appendTo("body"),b.off("keyup"+l),b.on("keyup"+l,function(a){27===a.keyCode&&m.length&&m[m.length-1].close()})}function c(c){var d=(a(document),a(window));b(),d.off("resize"+l),d.on("resize"+l,function(){f()}),"none"===i.css("display")&&i.css({display:"block",opacity:0}),i.stop().animate({opacity:1},{complete:function(){k.stop(),k.fadeIn({complete:c})}}),a("body").css({overflow:"hidden",height:"100%"})}function d(b){k&&k.hide(),i&&i.stop().animate({opacity:0},{complete:function(){i.hide(),i.css("opacity",1),"function"==typeof b&&b()}}),a("body").css({overflow:"",height:""})}function e(b){var c=a(window),d=c.height(),e=(d-b.outerHeight())/2;b.parent().scrollTop(0),b.each(function(){var a=this.style;a.margin="0 auto",a.position="relative",a.left=0,a.top=Math.max(e,0)+"px"})}function f(){m.length&&e(m[m.length-1]._el)}function g(b){return a("<div/>").addClass(h.className(b))}function h(a){this.setOptions(h.defaults,a),this._el=this._createDiv("modal").attr("data-role","modal"),this._header=this._createDiv("modal-header",this._el),this._close=this._createDiv("modal-close",this._header).attr("data-action","close"),this._title=this._createDiv("modal-title",this._header),this._body=this._createDiv("modal-body",this._el),this._footer=this._createDiv("modal-footer",this._el),this._buttons=this._createDiv("modal-buttons",this._footer,!0),this._close.html(this._options.closeHtml);var b=this;this._el.on("click",'[data-action="close"]',function(){b.close()})}var i,j,k,l=".maniple.modal",m=[];return h.prototype.setOptions=function(){return this._options=a.extend.apply(null,[!0,{}].concat(Array.prototype.slice.apply(arguments))),this},h.prototype._createDiv=function(b,c,d){var e=a("<div/>");return e.addClass(this._options.classPrefix+String(b)),d&&e.hide(),c&&e.appendTo(c),e},h.prototype.open=function(d){function f(){k.scrollTop(0),g._el.stop().fadeIn({step:function(){e(g._el)},complete:function(){g._trigger("open")}})}for(var g=this,h=0;h<m.length;++h)if(m[h]===this)throw new Error("This dialog is already opened");return d=a.extend({},this._options,d),m[m.length]=this,b(),k.children().hide(),["title","content","status","buttons"].forEach(function(a){var b=d[a];"undefined"!=typeof b&&g["set"+a.charAt(0).toUpperCase()+a.slice(1)](b)}),["open","beforeClose","close"].forEach(function(a){var b=d[a];g._el.unbind(a+l),"function"==typeof b&&g._el.bind(a+l,function(){b.apply(g,arguments)})}),this._el.hide(),this._el.appendTo(k),1===m.length&&c(),f(),this},h.prototype.close=function(){var a=this;if(m[m.length-1]!==this)throw new Error("This dialog is not the topmost");return a._trigger("beforeClose"),m.pop(),m.length?this._el.stop().fadeOut(function(){a._el.remove(),a._trigger("close"),m[m.length-1]._el.fadeIn()}):(d(),this._el.stop().fadeOut(function(){a._el.remove(),a._trigger("close")})),this},h.prototype.setTitle=function(a){return this._title.html(String(a)),this},h.prototype.getTitle=function(){return this._title.html()},h.prototype.setContent=function(a){switch(typeof a){case"function":a.call(this._body.get(0),this);break;default:this._body.empty().append(a)}return e(this._el),this},h.prototype.getContent=function(){return this._body.html()},h.prototype.getContentElement=function(){return this._body},h.prototype.setStatus=function(b){return this._body.find(".maniple-status-message").remove(),b=a.trim(b),b.length&&this._body.prepend(a('<div class="maniple-status-message" />').html(b)),this},h.prototype.getStatus=function(){return this._body.find(".maniple-status-message").html()},h.prototype.setButtons=function(b){this._buttons.empty();var c=this;return a.each(b,function(a,b){c.addButton(b)}),this._buttons.is(":empty")?this._buttons.hide():this._buttons.show(),this},h.prototype.addButton=function(b){var c=this,d=a('<button type="button"/>');switch(b.id&&d.attr("data-button-id",b.id),d.html(String(b.label)),typeof b.action){case"function":d.click(function(a){b.action.call(this,c,a)});break;case"string":d.attr("data-action",b.action)}b.className&&d.addClass(b.className),d.appendTo(this._buttons),this._buttons.show()},h.prototype.getButton=function(a){var b=String(a).replace(/"/g,'\\"');return this._buttons.find('[data-button-id="'+b+'"]').first()},h.prototype.addClass=function(a){return this._el.addClass(a),this},h.prototype.removeClass=function(a){return this._el.removeClass(a),this},h.prototype._trigger=function(a){this._el.trigger(a+l,[this])},h.defaults={classPrefix:"maniple-",closeHtml:"&times;"},h.className=function(a){return h.defaults.classPrefix+String(a)},h.open=function(a){return new h(a).open()},h.topmost=function(){return m[m.length-1]},h.centerTopmostDialog=f,h});